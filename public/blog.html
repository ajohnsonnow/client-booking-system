<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Blog ~ Ravi's Sacred Wisdom</title>
  <link rel="stylesheet" href="styles.css">
  <style>
    .blog-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 40px 20px;
    }

    .blog-header {
      text-align: center;
      margin-bottom: 48px;
    }

    .blog-header h1 {
      font-family: Georgia, serif;
      color: var(--burgundy);
      font-size: 42px;
      margin-bottom: 12px;
    }

    .blog-header p {
      color: var(--soft-gray);
      font-size: 18px;
    }

    .blog-filters {
      display: flex;
      justify-content: center;
      gap: 16px;
      margin-bottom: 40px;
      flex-wrap: wrap;
    }

    .filter-btn {
      padding: 12px 24px;
      border: 2px solid #e0d6cc;
      background: white;
      color: var(--text-primary);
      border-radius: 24px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-weight: 500;
    }

    .filter-btn:hover {
      border-color: var(--burgundy);
      color: var(--burgundy);
    }

    .filter-btn.active {
      background: var(--burgundy);
      color: white;
      border-color: var(--burgundy);
    }

    .blog-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
      gap: 32px;
      margin-bottom: 48px;
    }

    .blog-card {
      background: white;
      border: 1px solid #e0d6cc;
      border-radius: 16px;
      overflow: hidden;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      cursor: pointer;
    }

    .blog-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 24px rgba(114, 47, 55, 0.1);
    }

    .blog-card-image {
      width: 100%;
      height: 220px;
      object-fit: cover;
      background: linear-gradient(135deg, #f5f0eb 0%, #e0d6cc 100%);
    }

    .blog-card-content {
      padding: 24px;
    }

    .blog-card-category {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-size: 13px;
      color: var(--soft-gray);
      margin-bottom: 12px;
    }

    .blog-card-title {
      font-family: Georgia, serif;
      color: var(--burgundy);
      font-size: 22px;
      margin-bottom: 12px;
      line-height: 1.4;
    }

    .blog-card-excerpt {
      color: var(--soft-gray);
      font-size: 15px;
      line-height: 1.6;
      margin-bottom: 16px;
    }

    .blog-card-meta {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 13px;
      color: var(--soft-gray);
    }

    .single-post {
      max-width: 800px;
      margin: 0 auto;
      padding: 40px 20px;
    }

    .single-post-header {
      text-align: center;
      margin-bottom: 40px;
    }

    .single-post-category {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      font-size: 14px;
      color: var(--gold);
      margin-bottom: 16px;
      font-weight: 500;
    }

    .single-post-title {
      font-family: Georgia, serif;
      color: var(--burgundy);
      font-size: 42px;
      line-height: 1.3;
      margin-bottom: 16px;
    }

    .single-post-meta {
      color: var(--soft-gray);
      font-size: 15px;
    }

    .single-post-image {
      width: 100%;
      max-height: 500px;
      object-fit: cover;
      border-radius: 16px;
      margin-bottom: 32px;
    }

    .single-post-video {
      width: 100%;
      aspect-ratio: 16/9;
      border-radius: 16px;
      margin-bottom: 32px;
    }

    .single-post-content {
      font-size: 18px;
      line-height: 1.8;
      color: var(--text-primary);
      margin-bottom: 48px;
    }

    .single-post-content p {
      margin-bottom: 1.5em;
    }

    .back-to-blog {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 12px 24px;
      background: var(--burgundy);
      color: white;
      border-radius: 8px;
      text-decoration: none;
      transition: background 0.3s ease;
    }

    .back-to-blog:hover {
      background: #5a252c;
    }

    .no-posts {
      text-align: center;
      padding: 80px 20px;
      color: var(--soft-gray);
    }

    @media (max-width: 768px) {
      .blog-header h1 {
        font-size: 32px;
      }

      .blog-grid {
        grid-template-columns: 1fr;
      }

      .single-post-title {
        font-size: 32px;
      }
    }
  </style>
</head>
<body>
  <div class="blog-container">
    <!-- List View -->
    <div id="listView">
      <div class="blog-header">
        <h1>Wisdom & Inspiration</h1>
        <p>Sacred teachings from Ravi's journey</p>
      </div>

      <div class="blog-filters">
        <button class="filter-btn active" data-filter="all">All Posts</button>
        <button class="filter-btn" data-filter="sensual">üî• Sensual Arts</button>
        <button class="filter-btn" data-filter="spiritual">‚ú® Spiritual Wisdom</button>
      </div>

      <div class="blog-grid" id="blogGrid">
        <!-- Posts loaded via JavaScript -->
      </div>
    </div>

    <!-- Single Post View -->
    <div id="singleView" style="display: none;">
      <div class="single-post">
        <div class="single-post-header">
          <div class="single-post-category" id="postCategory"></div>
          <h1 class="single-post-title" id="postTitle"></h1>
          <div class="single-post-meta" id="postMeta"></div>
        </div>

        <img id="postImage" class="single-post-image" style="display: none;">
        <div id="postVideo" class="single-post-video" style="display: none;"></div>

        <div class="single-post-content" id="postContent"></div>

        <a href="/blog.html" class="back-to-blog">‚Üê Back to All Posts</a>
      </div>
    </div>
  </div>

  <script>
    let allPosts = [];
    let currentFilter = 'all';

    async function loadPosts() {
      try {
        const response = await fetch('/api/blog/posts');
        const data = await response.json();
        
        if (data.success && data.posts) {
          allPosts = data.posts;
          renderPosts();
        } else {
          showNoPosts();
        }
      } catch (error) {
        console.error('Error loading posts:', error);
        showNoPosts();
      }
    }

    function renderPosts() {
      const grid = document.getElementById('blogGrid');
      const filtered = currentFilter === 'all' 
        ? allPosts 
        : allPosts.filter(p => p.category === currentFilter);

      if (filtered.length === 0) {
        grid.innerHTML = '<div class="no-posts"><h2>No posts yet in this category</h2><p>Check back soon for new content!</p></div>';
        return;
      }

      grid.innerHTML = filtered.map(post => {
        const categoryIcon = post.category === 'sensual' ? 'üî•' : '‚ú®';
        const categoryName = post.category === 'sensual' ? 'Sensual Arts' : 'Spiritual Wisdom';
        const date = new Date(post.publishedAt || post.createdAt).toLocaleDateString('en-US', {
          year: 'numeric',
          month: 'long',
          day: 'numeric'
        });

        return `
          <div class="blog-card" onclick="viewPost('${post.id}')">
            ${post.imageUrl ? `<img src="${post.imageUrl}" class="blog-card-image" alt="${post.title}">` : '<div class="blog-card-image"></div>'}
            <div class="blog-card-content">
              <div class="blog-card-category">
                <span>${categoryIcon}</span>
                <span>${categoryName}</span>
              </div>
              <h2 class="blog-card-title">${post.title}</h2>
              <p class="blog-card-excerpt">${post.excerpt || post.content.substring(0, 150) + '...'}</p>
              <div class="blog-card-meta">
                <span>${date}</span>
                ${post.videoUrl ? '<span>üé• Video</span>' : ''}
              </div>
            </div>
          </div>
        `;
      }).join('');
    }

    function showNoPosts() {
      const grid = document.getElementById('blogGrid');
      grid.innerHTML = '<div class="no-posts"><h2>Coming Soon</h2><p>Ravi is preparing inspiring content to share. Check back soon!</p></div>';
    }

    async function viewPost(id) {
      try {
        const response = await fetch(`/api/blog/posts/${id}`);
        const data = await response.json();
        
        if (data.success && data.post) {
          const post = data.post;
          
          // Show single view
          document.getElementById('listView').style.display = 'none';
          document.getElementById('singleView').style.display = 'block';

          // Category
          const categoryIcon = post.category === 'sensual' ? 'üî•' : '‚ú®';
          const categoryName = post.category === 'sensual' ? 'Sensual Arts' : 'Spiritual Wisdom';
          document.getElementById('postCategory').innerHTML = `<span>${categoryIcon}</span> ${categoryName}`;

          // Title
          document.getElementById('postTitle').textContent = post.title;

          // Meta
          const date = new Date(post.publishedAt || post.createdAt).toLocaleDateString('en-US', {
            year: 'numeric',
            month: 'long',
            day: 'numeric'
          });
          document.getElementById('postMeta').textContent = `Published ${date}`;

          // Image
          const img = document.getElementById('postImage');
          if (post.imageUrl) {
            img.src = post.imageUrl;
            img.style.display = 'block';
          } else {
            img.style.display = 'none';
          }

          // Video
          const videoContainer = document.getElementById('postVideo');
          if (post.videoUrl) {
            const videoId = extractVideoId(post.videoUrl);
            if (videoId.youtube) {
              videoContainer.innerHTML = `<iframe width="100%" height="100%" src="https://www.youtube.com/embed/${videoId.youtube}" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>`;
              videoContainer.style.display = 'block';
            } else if (videoId.vimeo) {
              videoContainer.innerHTML = `<iframe src="https://player.vimeo.com/video/${videoId.vimeo}" width="100%" height="100%" frameborder="0" allow="autoplay; fullscreen; picture-in-picture" allowfullscreen></iframe>`;
              videoContainer.style.display = 'block';
            }
          } else {
            videoContainer.style.display = 'none';
          }

          // Content (preserve line breaks)
          document.getElementById('postContent').innerHTML = post.content.split('\n').map(p => p.trim() ? `<p>${p}</p>` : '').join('');

          // Update URL without reload
          window.history.pushState({}, '', `/blog.html?id=${id}`);
          window.scrollTo(0, 0);
        }
      } catch (error) {
        console.error('Error loading post:', error);
      }
    }

    function extractVideoId(url) {
      // YouTube
      const youtubeMatch = url.match(/(?:youtube\.com\/watch\?v=|youtu\.be\/)([a-zA-Z0-9_-]{11})/);
      if (youtubeMatch) return { youtube: youtubeMatch[1] };

      // Vimeo
      const vimeoMatch = url.match(/vimeo\.com\/(\d+)/);
      if (vimeoMatch) return { vimeo: vimeoMatch[1] };

      return {};
    }

    // Filter buttons
    document.querySelectorAll('.filter-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        currentFilter = btn.dataset.filter;
        renderPosts();
      });
    });

    // Check if viewing single post on load
    const urlParams = new URLSearchParams(window.location.search);
    const postId = urlParams.get('id');

    if (postId) {
      loadPosts().then(() => viewPost(postId));
    } else {
      loadPosts();
    }
  </script>
</body>
</html>
