# üöÄ Deployment Guide - Render.com

**Last Updated**: 2026-02-13  
**Branch**: ravi-sacred-healing  
**Hosting**: Render.com Web Service (Free Tier)

---

## Why Render.com Web Service?

‚úÖ **Correct Choice**: Web Service (NOT Private Service)
- Provides public HTTPS access for client bookings
- Free tier: 750 hours/month (enough for 24/7 with sleep mode)
- Automatic SSL certificates
- Custom domain support
- GitHub auto-deploy on push
- Environment variable management
- Health checks and monitoring

---

## Step-by-Step Deployment

### 1. GitHub Preparation
```bash
# Ensure you're on the production branch
git checkout ravi-sacred-healing

# Run pre-deploy checks
node scripts/pre-deploy.js

# Commit any changes
git add .
git commit -m "chore: pre-deploy preparation v$(node -p "require('./package.json').version")"

# Push to GitHub
git push origin ravi-sacred-healing
```

### 2. Render.com Account Setup
1. Go to https://render.com
2. Sign up with GitHub account
3. Authorize Render to access your repositories

### 3. Create Web Service
1. Click **"New +"** ‚Üí **"Web Service"**
2. Connect your GitHub repository
3. Select the **ravi-sacred-healing** branch

### 4. Configure Service

**Basic Settings:**
- **Name**: `ravi-sacred-healing-cms` (or your choice)
- **Region**: Oregon (US West) or closest to your clients
- **Branch**: `ravi-sacred-healing`
- **Root Directory**: (leave blank)
- **Runtime**: Node
- **Build Command**: `npm install`
- **Start Command**: `npm start`

**Instance Type:**
- Select **"Free"** (750 hours/month)
- Note: Service will sleep after 15 min of inactivity
- First request after sleep takes 30-60 seconds

### 5. Environment Variables

Click **"Advanced"** and add these environment variables:

```
NODE_ENV=production
PORT=3000
ADMIN_PASSWORD=<your-secure-password>
JWT_SECRET=<generate-random-64-char-string>

# Email Provider (choose one):
EMAIL_PROVIDER=gmail
EMAIL_USER=your-email@gmail.com
EMAIL_APP_PASSWORD=<gmail-app-password>

# SMS Provider (optional):
SMS_PROVIDER=twilio
TWILIO_ACCOUNT_SID=<your-twilio-sid>
TWILIO_AUTH_TOKEN=<your-twilio-token>
TWILIO_PHONE_NUMBER=<your-twilio-number>

# Session (optional, generated if not set):
SESSION_SECRET=<random-string>
```

**‚ö†Ô∏è Security Tips:**
- Never commit secrets to GitHub
- Generate strong JWT_SECRET: `openssl rand -base64 64`
- Use Gmail App Passwords (not regular password)
- Store backup of env vars securely offline

### 6. Deploy

1. Click **"Create Web Service"**
2. Wait for initial deployment (3-5 minutes)
3. Watch build logs for errors
4. Service URL: `https://ravi-sacred-healing-cms.onrender.com`

### 7. Custom Domain (Optional)

1. Go to service Settings ‚Üí Custom Domain
2. Add your domain: `app.ravisacredhealing.com`
3. Add CNAME record at your DNS provider:
   - **Type**: CNAME
   - **Name**: app (or @)
   - **Value**: `ravi-sacred-healing-cms.onrender.com`
4. Wait for DNS propagation (5-60 minutes)
5. SSL certificate auto-generated by Render

---

## Post-Deployment

### Verify Functionality
- [ ] Visit your app URL
- [ ] Test gate page (`/`)
- [ ] Test admin login (`/admin.html`)
- [ ] Test client portal (`/portal.html`)
- [ ] Test blog page (`/blog.html`)
- [ ] Submit test inquiry
- [ ] Verify email notifications work
- [ ] Test SMS (if configured)

### Data Initialization
On first deploy, data files will be created automatically:
```
/data/
  ‚îú‚îÄ‚îÄ clients.enc          (encrypted)
  ‚îú‚îÄ‚îÄ bookings.enc         (encrypted)
  ‚îú‚îÄ‚îÄ inquiries.enc        (encrypted)
  ‚îú‚îÄ‚îÄ blog_posts.enc       (encrypted)
  ‚îú‚îÄ‚îÄ invitation_codes.enc (encrypted)
  ‚îî‚îÄ‚îÄ magic_links.enc      (encrypted)
```

### Security Checklist
- [x] HTTPS enabled (automatic with Render)
- [ ] Strong ADMIN_PASSWORD set
- [ ] JWT_SECRET is random and secure
- [ ] Email credentials using app password
- [ ] No secrets in GitHub repository
- [ ] .env file in .gitignore
- [ ] Rate limiting active (built-in)
- [ ] Data encryption active (AES-256-GCM)

---

## Monitoring & Maintenance

### Health Checks
Render automatically monitors:
- HTTP response codes
- Response times
- Memory usage
- CPU usage

### Logs
- View live logs: Service ‚Üí Logs tab
- Search logs by date/keyword
- Download logs for debugging

### Auto-Deploy
Every push to `ravi-sacred-healing` triggers automatic deployment:
1. Render detects push
2. Runs build command
3. Restarts service
4. Keeps data files intact

### Backup Strategy
**Automatic backups** already configured:
- Hourly backups to `/data/backups/auto/`
- Manual backups via Admin ‚Üí Backup tab
- Download backups before major updates

### Sleep Mode (Free Tier)
- Service sleeps after 15 min inactivity
- First request takes 30-60 sec to wake
- Upgrade to paid ($7/mo) for always-on

---

## Troubleshooting

### Build Fails
```bash
# Check logs for missing dependencies
npm install --production

# Verify start command works locally
npm start
```

### Service Won't Start
- Check environment variables are set
- Verify PORT is not hardcoded (use process.env.PORT)
- Check for syntax errors in server.js

### Email Not Sending
- Verify EMAIL_PROVIDER is set
- Use Gmail App Password (not account password)
- Check rate limits (Gmail: 500/day)

### Data Loss
- Data persists across deploys
- Download backups regularly via Admin panel
- Consider upgrading to paid tier for disk persistence guarantees

### 502 Bad Gateway
- Service may be sleeping (first request takes 30-60s)
- Check logs for startup errors
- Verify start command is correct

---

## Cost Breakdown

| Tier | Price | Hours/Month | Sleep | SSL | Custom Domain |
|------|-------|-------------|-------|-----|---------------|
| Free | $0 | 750 | Yes (15min) | ‚úÖ | ‚úÖ |
| Starter | $7/mo | Always On | No | ‚úÖ | ‚úÖ |

**Current Setup**: Free tier is sufficient
**Upgrade When**: You need 24/7 instant response time

---

## Support Resources

- **Render Docs**: https://render.com/docs
- **Node.js on Render**: https://render.com/docs/deploy-node-express-app
- **Support**: https://render.com/support

---

## Feature Merge to Main Template

When ready to merge features back to `main` branch:

### Features to Port:
- ‚úÖ Blog/Vlog system (configurable categories)
- ‚úÖ SMS messaging integration
- ‚úÖ CSV client import
- ‚úÖ Available hours API endpoint
- ‚úÖ Auto-backup improvements

### Must Strip:
- ‚ùå "Ravi" name references
- ‚ùå "Sacred Healing" branding
- ‚ùå Client data files
- ‚ùå Spiritual-specific content
- ‚ùå Blog posts

### Keep Generic:
- ‚úÖ Blog categories as configurable
- ‚úÖ SMS as optional provider
- ‚úÖ Available hours as template feature
- ‚úÖ All functionality intact

---

**üéâ Deployment Complete!**  
Your CMS is now live and accessible worldwide with enterprise-grade security.
